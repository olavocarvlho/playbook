(async()=>{let e={IsUserDefined:!1,Email:void 0,UserId:void 0,organizationId:void 0};let o="";const l="plugone_social_sell_cart_footer",n="plugone_social_sell_cart_footer_action_item",t="plugone_social_sell_cart_footer_share_item",a=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"});async function s(){return await fetch("/api/checkout/pub/orderForm",{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json","cache-Control":"no-cache"}}).then(e=>e.json()).then(e=>{globalThis.plugone.orderForm=e}).catch(e=>{console.log(e)})}async function c(){const o=globalThis.plugone.orderForm.orderFormId;if(!o)return v("Order form id not found","error");let l={url:`${window.location.origin}/checkout/?orderFormId=${o}#/cart#`};const n={method:"post",headers:{"Content-Type":"application/json","sales-token":globalThis.plugone.sale_vtex_pixel},body:JSON.stringify({query:"\n    mutation generateSalesShorten($input: GenerateSalesShortenInput!) {\n        generateSalesShorten(input: $input){\n            id\n            originalUrl\n            shortUrl\n            urlCode\n            createdAt\n            updatedAt\n        }\n    }\n  ",variables:{input:l}})};await async function(){if(!globalThis.plugone.sale_id)return v("Sale id doesnt exists","error");await vtexjs.checkout.getOrderForm();const o={utmSource:"plugone_sale_affiliate",utmMedium:null,utmCampaign:`${globalThis.plugone.sale_id}_${e.organizationId}`,utmipage:"",utmiPart:"",utmiCampaign:"",coupon:null,marketingTags:[]};await vtexjs.checkout.sendAttachment("marketingData",o)}(),await fetch("http://api.plugone.io/graphql",n).then(e=>e.json()).then(({data:e})=>{if(e.generateSalesShorten){const{shortUrl:o}=e.generateSalesShorten;globalThis.plugone.cartUrlToShare=o,document.querySelector(".plugone_social_sell_cart_footer_share_input").value=o}}).catch(e=>{console.log("orderFormLinkGenerator: "+e.message)})}function i(e,o,l=1,n="1"){const t=globalThis.plugone.orderForm.items.findIndex(o=>o.id==e);if(0===l&&-1===t)return v("Item nao existe no carrinho","error");const a={orderItems:[{seller:n,quantity:l,id:e}]};var c;-1!==t&&(a.orderItems[0].index=t),fetch((c=globalThis.plugone.orderForm.orderFormId,`/api/checkout/pub/orderForm/${c}/items`),{method:"PATCH",body:JSON.stringify(a),headers:{Accept:"application/json","Content-Type":"application/json"}}).then(e=>e.json()).then(async e=>{e.orderFormId&&(await s(),h(),o&&o())}).catch(e=>{console.log(e.message)})}function r(e,o){Object.keys(e).map((e,l)=>{let n=`.Plugone__${e.replace(/ /gi,"")}__Select`;document.querySelector(n).addEventListener("change",(function(t){let a=t.target.getAttribute("data-tag"),s=t.target.value,c=globalThis.plugone.skuSelector.findIndex(o=>o[e]);-1!==c?globalThis.plugone.skuSelector[c][a]=s:globalThis.plugone.skuSelector.push({[a]:s});let i=o.filter(e=>e.dimensions[a]===s),r={};i.map(e=>{let o=e.dimensions;Object.keys(o).map(e=>{r[e]&&r[e].length?r[e].contains(o[e])||r[e].push(o[e]):r[e]=[o[e]]})}),Array.from(document.querySelectorAll(`select:not(${n})`)).map(e=>{let o,n=e.getAttribute("data-tag"),t=globalThis.plugone.skuSelector.findIndex(e=>e[n]),a=r[n];e.options.length=0,a.map((a,s)=>{globalThis.plugone.skuSelector[t]&&globalThis.plugone.skuSelector[t][n]===a&&(o=s);var c=document.createElement("option");c.class=`Plugone__SkuItem__Button_${l}_${s}`,c.text=a,c.value=a,e.appendChild(c)}),o&&(e.selectedIndex=o)})}))}),document.querySelector(".plugone_social_sell_add_to_cart").addEventListener("click",()=>{const e=skuJson.skus.find(e=>e.skuname===globalThis.plugone.skuSelector.map(e=>Object.values(e)[0]).join(" - "));if(e){const o=()=>{g(),h(),v("Item adicionado com sucesso.")};let l=globalThis.plugone.orderForm.items.find(o=>o.id==e.sku);l=l?l.quantity+1:1,i(e.sku,o,l)}})}function _(e,o,l,n=1,t="1"){document.querySelector(e).addEventListener("click",(function(e){i(o,l,n,t)}))}function u(e){return e.map(e=>{return`\n      <article class="plugone_social_sell_cart_product" data-product-id="${e.id}">\n        <div class="plugone_social_sell_cart_product_thumb">\n          <button\n            data-remove-product-id="${e.id}"\n            class="plugone_social_sell_cart_product_remove_button"\n          ></button>\n          <img alt=${e.name} src="${e.imageUrl}" class="plugone_social_sell_cart_product_image" />\n        </div>\n\n        <div class="plugone_social_sell_cart_product_info">\n          <p class="plugone_social_sell_cart_product_title">${e.name}</p>\n\n          <div class="plugone_social_sell_cart_product_actions">\n            <div class="plugone_social_sell_cart_product_qty_container">\n              <span\n                class="plugone_social_sell_cart_product_qty_down"\n                data-product-remove-qty="${e.id}">-</span>\n              <input\n                class="plugone_social_sell_cart_product_qty"\n                type="number"\n                min="0"\n                max="100"\n                value="${e.quantity}"\n              />\n              <span\n                class="plugone_social_sell_cart_product_qty_up"\n                data-product-add-qty="${e.id}">+</span>\n            </div>\n            <span class="plugone_social_sell_cart_product_price">${o=e.price,a.format(o/100)}</span>\n          </div>\n        </div>\n      </article>\n    `;var o}).join("")}function p(){var e,o;document.body.appendChild((e='\n      <div class="plugone_social_sell">\n        <div class="plugone_social_sell_snackbar"></div>\n        <div class="plugone_social_sell_container">\n          <div class="plugone_social_sell_cart">\n            <header class="plugone_social_sell_cart_header">\n              <span\n                class="plugone_social_sell_close_button plugone_social_sell_cart_header_close"\n              ></span>\n              <div class="plugone_social_sell_cart_header_title">\n                <h2 class="plugone_social_sell_cart_header_title_name"></h2>\n                <p>Compartilhe os produtos do carrinho.</p>\n              </div>\n            </header>\n\n            <section class="plugone_social_sell_cart_content">\n            </section>\n\n            <section class="plugone_social_sell_cart_items"></section>\n\n            <footer class="plugone_social_sell_cart_footer">\n              <div class="plugone_social_sell_cart_footer_header">\n                <div class="plugone_social_sell_cart_footer_title">\n                  Escolha uma opção para <strong>compartilhar</strong>\n                </div>\n                <span\n                  class="plugone_social_sell_close_button plugone_social_sell_cart_footer_close"\n                ></span>\n              </div>\n              <ul class="plugone_social_sell_cart_footer_actions">\n                <li>\n                  <button\n                    class="plugone_social_sell_cart_footer_action_item plugone_social_sell_cart_footer_action_item--link"\n                  >\n                    Link\n                  </button>\n                </li>\n                <li>\n                  <button\n                    class="plugone_social_sell_cart_footer_action_item plugone_social_sell_cart_footer_action_item--whatsapp"\n                  >\n                    WhatsApp\n                  </button>\n                </li>\n                <li>\n                  <button\n                    class="plugone_social_sell_cart_footer_action_item plugone_social_sell_cart_footer_action_item--email"\n                  >\n                    E-mail\n                  </button>\n                </li>\n              </ul>\n\n              <div class="plugone_social_sell_cart_footer_share_container">\n                <div\n                  class="plugone_social_sell_cart_footer_share_item plugone_social_sell_cart_footer_share_item--link"\n                >\n                  <div class="plugone_social_sell_cart_footer_share_title">\n                    Copie o link abaixo e compartilhe\n                  </div>\n                  <input\n                    readonly\n                    data-share-link="copylink"\n                    class="plugone_social_sell_cart_footer_share_input"\n                    type="text"\n                    value=""\n                  />\n                  <button data-share-link-button="copylink" class="plugone_social_sell_cart_footer_share_button">\n                    Copiar Link\n                  </button>\n                </div>\n\n                <div\n                  class="plugone_social_sell_cart_footer_share_item plugone_social_sell_cart_footer_share_item--whatsapp"\n                >\n                  <div class="plugone_social_sell_cart_footer_share_title">\n                    Copie o link abaixo e compartilhe\n                  </div>\n                  <input\n                    data-share-link="whatsapp"\n                    class="plugone_social_sell_cart_footer_share_input"\n                    type="text"\n                    placeholder="(00) 00000-0000"\n                    value=""\n                  />\n                  <button data-share-link-button="whatsapp" class="plugone_social_sell_cart_footer_share_button">\n                    Compartilhar\n                  </button>\n                </div>\n\n                <div\n                  class="plugone_social_sell_cart_footer_share_item plugone_social_sell_cart_footer_share_item--email"\n                >\n                  <div class="plugone_social_sell_cart_footer_share_title">\n                    Insira o e-mail que quer compartilhar\n                  </div>\n                  <input\n                    data-share-link="email"\n                    class="plugone_social_sell_cart_footer_share_input"\n                    type="email"\n                    placeholder="exemplo@email.com"\n                    value=""\n                  />\n                  <button data-share-link-button="email" class="plugone_social_sell_cart_footer_share_button">\n                    Compartilhar\n                  </button>\n                </div>\n              </div>\n              <button class="plugone_social_sell_cart_footer_new_cart">\n                Criar Novo Carrinho\n              </button>\n            </footer>\n          </div>\n          <div class="plugone_social_sell_actions">\n            <div class="plugone_social_sell_actions_tooltip">\n              <p class="plugone_social_sell_tooltip_text"></p>\n            </div>\n            <div class="plugone_social_sell_actions_buttons">\n              <button\n                class="plugone_social_cart_button plugone_social_cart_button--white plugone_social_sell_add_to_cart_button"\n              >\n                <i\n                  class="plugone_social_cart_button__icon plugone_social_cart_button__icon--add-to-cart"\n                ></i>\n              </button>\n              <button\n                class="plugone_social_cart_button plugone_social_cart_button_see plugone_social_cart_button--white"\n              >\n                <i\n                  class="plugone_social_cart_button__icon plugone_social_cart_button__icon--see"\n                ></i>\n              </button>\n            </div>\n            <button\n              class="plugone_social_cart_button plugone_social_cart_button--trigger"\n            >\n              <i\n                class="plugone_social_cart_button__icon plugone_social_cart_button__icon--plug"\n              ></i>\n            </button>\n          </div>\n        </div>\n\n        <div class="plugone_social_sell_modal">\n          <div class="plugone_social_sell_modal_overlay"></div>\n          <div class="plugone_social_sell_modal_wrapper">\n            <div class="plugone_social_sell_modal_header">\n              <h2>\n                Selecione uma opção\n              </h2>\n              <span\n                class="plugone_social_sell_close_button plugone_social_sell_toggle_modal"\n              ></span>\n            </div>\n\n            <div class="plugone_social_sell_modal_content"></div>\n\n            <button class="plugone_social_sell_add_to_cart plugone_social_sell_cart_footer_share_button">\n              Adicionar ao Carrinho\n            </button>\n          </div>\n        </div>\n      </div>\n    ',(o=document.createElement("div")).innerHTML=e.trim(),o.firstChild))}function d(e){document.querySelector(`.${n}--${e}`).addEventListener("click",async()=>{""===o&&(o=e),await c(),document.querySelector("."+l).classList.add(l+"--opened");document.querySelector("."+l).classList.contains(l+"--opened")&&(document.querySelector(`.${t}--${o}`).classList.remove(t+"--opened"),document.querySelector(`.${n}--${o}`).classList.remove(n+"--selected"),o=e,document.querySelector(`.${t}--${e}`).classList.toggle(t+"--opened"),document.querySelector(`.${n}--${e}`).classList.toggle(n+"--selected"))})}function g(){document.querySelector(".plugone_social_sell_modal").classList.toggle("plugone_social_sell_modal--opened")}function m(){if(document.querySelector(".plugone_social_cart_button--trigger").addEventListener("click",()=>{document.querySelector(".plugone_social_sell_actions_buttons").classList.toggle("plugone_social_sell_actions_buttons--opened")}),document.querySelector(".plugone_social_sell_close_button").addEventListener("click",()=>{document.querySelector(".plugone_social_sell_cart").classList.remove("plugone_social_sell_cart--opened"),document.querySelector(".plugone_social_sell_cart").classList.add("plugone_social_sell_cart--closed")}),document.querySelector(".plugone_social_cart_button_see").addEventListener("click",()=>{document.querySelector(".plugone_social_sell_cart").classList.toggle("plugone_social_sell_cart--opened")}),document.querySelector(".plugone_social_sell_cart_footer_new_cart").addEventListener("click",async()=>{document.cookie=`checkout.vtex.com=;Domain=.${window.location.hostname};path=/;expires=Thu, 01-Jan-1970 00:00:01 GMT`,document.cookie=`checkout.vtex.com=;Domain=${window.location.hostname.replace("www","")};path=/;expires=Thu, 01-Jan-1970 00:00:01 GMT`,await s(),h()}),"undefined"==typeof skuJson)return document.querySelector(".plugone_social_sell_add_to_cart_button").style.display="none";document.querySelector(".plugone_social_sell_add_to_cart_button").addEventListener("click",()=>{if(skuJson.skus.length>1)g();else{const e=skuJson.skus[0].sku;let o=globalThis.plugone.orderForm.items.find(o=>o.id==e);o=o?o.quantity+1:1,i(e,h,o),v("Item adicionado com sucesso.")}}),document.querySelector(".plugone_social_sell_toggle_modal").addEventListener("click",g)}function h(){let e;globalThis.plugone.orderForm.items.length?(e=u(globalThis.plugone.orderForm.items),document.querySelector(".plugone_social_sell_cart_content").innerHTML=e,globalThis.plugone.orderForm.items.forEach(e=>{_(`[data-remove-product-id="${e.id}"]`,e.id,void 0,0),_(`[data-product-remove-qty="${e.id}"]`,e.id,void 0,e.quantity-1),_(`[data-product-add-qty="${e.id}"]`,e.id,void 0,e.quantity+1)}),document.querySelector(".plugone_social_sell_cart_footer").classList.add("plugone_social_sell_cart_footer--show"),document.querySelector(".plugone_social_sell_cart_footer_close").addEventListener("click",()=>{document.querySelector(".plugone_social_sell_cart_footer").classList.remove("plugone_social_sell_cart_footer--opened"),document.querySelector(`.${t}--${o}`).classList.toggle(t+"--opened"),document.querySelector(`.${n}--${o}`).classList.toggle(n+"--selected")}),d("link"),d("whatsapp"),d("email"),document.querySelector('[data-share-link-button="whatsapp"]').addEventListener("click",()=>{const e=document.querySelector('[data-share-link="whatsapp"]').value;if(e){const o=new URL("https://api.whatsapp.com/send");o.searchParams.append("phone","55"+e),o.searchParams.append("text","Olá, aqui o link do seu carrinho para finalizar sua compra: "+globalThis.plugone.cartUrlToShare),window.open(o.href),document.querySelector('[data-share-link="whatsapp"]').value=""}else v("Informe um número valido para compartilhar o link.","error")}),document.querySelector('[data-share-link-button="email"]').addEventListener("click",()=>{const e=document.querySelector('[data-share-link="email"]').value;if(e){const o="PugOne Social Selling - Finalizar compra",l="Olá, aqui o link do seu carrinho para finalizar sua compra: "+globalThis.plugone.cartUrlToShare;window.open(`mailto:${e}?subject=${o}&body=${l}`)}else v("Informe um e-mail valido para compartilhar o link.","error")}),document.querySelector('[data-share-link-button="copylink"]').addEventListener("click",()=>{const e=document.querySelector('[data-share-link="copylink"]');e.value&&(e.select(),e.setSelectionRange(0,99999),document.execCommand("copy"),v("Copiado com sucesso."))})):(e='\n      <section class="plugone_social_sell_empty_cart">\n        <div class="plugone_social_sell_empty_cart_icon"></div>\n        <div class="plugone_social_sell_empty_cart_title">\n          Seu carrinho está vazio.\n        </div>\n        <div class="plugone_social_sell_empty_cart_text">\n          Adicione produtos para compartilhar!\n        </div>\n    </section>\n    ',document.querySelector(".plugone_social_sell_cart_content").innerHTML=e,document.querySelector(".plugone_social_sell_cart_footer").classList.remove("plugone_social_sell_cart_footer--show"))}function v(e,o){if(e){const l=document.querySelector(".plugone_social_sell_snackbar");l.innerHTML=e;const n=o?"plugone_social_sell_snackbar--"+o:"";l.classList.add("plugone_social_sell_snackbar--opened"),n&&l.classList.add(n),setTimeout((function(){l.classList.remove("plugone_social_sell_snackbar--opened"),n&&l.classList.remove(n),l.innerHTML=""}),3e3)}}!async function(){return globalThis.plugone={},globalThis.plugone.skuSelector=[],await async function(){await fetch("/no-cache/profileSystem/getProfile",{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json","cache-Control":"no-cache"}}).then(e=>e.json()).then(o=>{o.UserId&&(globalThis.plugone.client=o,e={IsUserDefined:!0,Email:o.Email,UserId:o.UserId})}).catch(e=>{console.log(e)})}(),console.log(e,window.__plugone),!!e.Email&&(e.organizationId=window.__plugone.organizationId,await async function(){const o={email:e.Email,organizationId:e.organizationId,serviceName:"affiliate"},l={method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:"\n      mutation generateSalesJwt($input: GenerateSalesJwtInput!) {\n          generateSalesJwt(input: $input){\n            salesId\n            vtexSalePixelJwt\n          }\n      }\n  ",variables:{input:o}})};console.log(""),await fetch("http://api.plugone.io/graphql",l).then(e=>e.json()).then(({data:e})=>{globalThis.plugone.sale_vtex_pixel=e.generateSalesJwt.vtexSalePixelJwt,globalThis.plugone.sale_id=e.generateSalesJwt.salesId}).catch(e=>{console.log(e)})}(),(o=document.createElement("link")).setAttribute("rel","stylesheet"),o.setAttribute("type","text/css"),o.setAttribute("href","https://plugone-staging.nyc3.digitaloceanspaces.com/pixel-affiliate/staging-pixel-sale-affiliate.css"),document.head.appendChild(o),await s(),globalThis.plugone.sale_vtex_pixel?(p(),function(){if("undefined"!=typeof skuJson&&skuJson.skus.length>1){let e={};skuJson.skus.forEach(o=>{let l=o.dimensions;Object.keys(l).forEach(o=>{e[o]&&e[o].length?e[o].contains(l[o])||e[o].push(l[o]):e[o]=[l[o]]})});const o=Object.keys(e).map((o,l)=>`\n            <div class="plugone_social_sell_modal_field">\n            <label>${o}</label>\n            <select data-tag="${o}" class="Plugone__${o.replace(/ /gi,"")}__Select">\n              <option>Selecione</option>\n              ${e[o].map((e,o)=>`<option class="Plugone__SkuItem__Button_${l}_${o}">${e}</option>`).join("")}\n            </select>\n          </div>`).join("");document.querySelector(".plugone_social_sell_modal_content").innerHTML=o,r(skuJson.dimensionsMap,skuJson.skus)}}(),h(),m(),void function(){const{FirstName:e,Email:o}=globalThis.plugone.client;document.querySelector(".plugone_social_sell_cart_header_title_name").innerHTML=`Olá, ${e||o}.`,document.querySelector(".plugone_social_sell_actions_tooltip").classList.toggle("plugone_social_sell_actions_tooltip--opened"),document.querySelector(".plugone_social_sell_tooltip_text").innerHTML=`Olá, <strong>${e||o}</strong>. Eu sou a <b>plugOne</b>, seu carrinho compartilhável pessoal. Clique em mim para adicionar este produto e compartilhar!`,setTimeout(()=>{document.querySelector(".plugone_social_sell_actions_tooltip").classList.toggle("plugone_social_sell_actions_tooltip--opened")},8e3)}()):v("jwt not provided from server"));var o}()})();
